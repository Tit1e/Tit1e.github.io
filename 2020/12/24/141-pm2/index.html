<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>pm2 基础使用指南 · Tit1e</title><meta name="description" content="pm2 基础使用指南 - Tit1e"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/Tit1e/atom.xml" title="Tit1e"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">过往</a></li><li class="nav-list-item"><a href="https://album.animalcrossing.life" target="_blank" class="nav-list-link">摄影集</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">订阅</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">pm2 基础使用指南</h1><div class="post-info">Dec 24, 2020</div><div class="post-content"><p><a href="https://github.com/Unitech/pm2">pm2</a> 我想用 Node.js 在服务器上搭过服务的应该都知道。因为正常情况跑 node 服务需要在终端执行 <code>node inde.js</code> 命令，而服务器我们一般是使用终端通过 SSH 远程连接，我们不可能一直保持与服务器的连接，也不可能一直开着运行服务的终端窗口，所以我们需要一个工具来帮忙挂着这个服务，pm2 就是这么个工具。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install pm2 -g</span><br></pre></td></tr></table></figure>
<h2 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h2><h4 id="启动某个服务"><a href="#启动某个服务" class="headerlink" title="启动某个服务"></a>启动某个服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --watch 表示：服务文件发生变化时，pm2会自动帮你重启服务</span></span><br><span class="line">pm2 start app.js --watch</span><br><span class="line">以 xxx 为命名启动进程</span><br><span class="line">pm2 start app.js --watch --name xxx</span><br></pre></td></tr></table></figure>
<h4 id="查看启动中的服务"><a href="#查看启动中的服务" class="headerlink" title="查看启动中的服务"></a>查看启动中的服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 list</span><br></pre></td></tr></table></figure>
<p><img src="https://personal-1251959693.cos.ap-chengdu.myqcloud.com/2020-12-24-063206.png" alt></p>
<h4 id="停止某个或全部服务"><a href="#停止某个或全部服务" class="headerlink" title="停止某个或全部服务"></a>停止某个或全部服务</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pm2 stop name || id || <span class="string">'all'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 比如我要停止上图中名为 JinYa 的这个服务</span></span><br><span class="line">pm2 stop JinYa</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">pm2 stop 2</span><br><span class="line"><span class="comment"># 如果停止全部</span></span><br><span class="line">pm2 stop all</span><br></pre></td></tr></table></figure>
<h4 id="重启某个或全部服务"><a href="#重启某个或全部服务" class="headerlink" title="重启某个或全部服务"></a>重启某个或全部服务</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pm2 restart name || id || <span class="string">'all'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 比如我要重启上图中名为 JinYa 的这个服务</span></span><br><span class="line">pm2 restart JinYa</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">pm2 restart 2</span><br><span class="line"><span class="comment"># 如果停止全部</span></span><br><span class="line">pm2 restart all</span><br></pre></td></tr></table></figure>
<h4 id="删除某个或全部服务"><a href="#删除某个或全部服务" class="headerlink" title="删除某个或全部服务"></a>删除某个或全部服务</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pm2 delete name || id || <span class="string">'all'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 比如我要重启上图中名为 JinYa 的这个服务</span></span><br><span class="line">pm2 delete JinYa</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">pm2 delete 2</span><br><span class="line"><span class="comment"># 如果停止全部</span></span><br><span class="line">pm2 delete all</span><br></pre></td></tr></table></figure>
<h4 id="查看某个服务的描述"><a href="#查看某个服务的描述" class="headerlink" title="查看某个服务的描述"></a>查看某个服务的描述</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 describe name || id</span><br></pre></td></tr></table></figure>
<p>如果服务器上有十几甚至几十个服务，那么一个一个启动就显得十分繁琐，所以 pm2 也可以通过配置文件启动。</p>
<h4 id="通过配置文件批量启动"><a href="#通过配置文件批量启动" class="headerlink" title="通过配置文件批量启动"></a>通过配置文件批量启动</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 创建一个名为 server.json 的文件</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"apps"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      "name": "server1", // 服务名称</span><br><span class="line">      "script": "./xxx/index.js", // 服务入口文件路径</span><br><span class="line">      "watch": true // 监听服务，服务发生变化时自动重启</span><br><span class="line">    &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"server2"</span>,</span><br><span class="line">      <span class="attr">"script"</span>: <span class="string">"./xxx/app.js"</span>,</span><br><span class="line">      <span class="attr">"watch"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start server.json</span><br></pre></td></tr></table></figure>
<p>上面 <code>stop</code>、<code>restar</code>、<code>delete</code> 命令其实都可通过 json 文件来批量执行。</p>
<h4 id="查看进程资源消耗情况"><a href="#查看进程资源消耗情况" class="headerlink" title="查看进程资源消耗情况"></a>查看进程资源消耗情况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 monit</span><br></pre></td></tr></table></figure>
<p>上面这些命令只是一些我在日常使用中经常用到的基础命令，pm2 这个工具所能做的远远不止这些。它还可以做负载均衡，内存监控等其他很多事情，只是我的应用场景没用那么复杂，所以并没有深入了解这些功能。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2020/12/28/142-node-spider/" class="prev">上一篇</a><a href="/2020/12/23/140-alipay-shortcuts/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2021 <a href="https://github.com/Tit1e" target="_blank">Tit1e</a>, powered by <a href="https://github.com/Tit1e/hexo-theme-simple" target="_blank">hexo-theme-simple</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>