<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>计算不透明度对应的十六进制数值 · Tit1e</title><meta name="description" content="计算不透明度对应的十六进制数值 - Tit1e"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/Tit1e/atom.xml" title="Tit1e"></head><body><div class="wrap"><header><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">过往</a></li><li class="nav-list-item"><a href="https://album.animalcrossing.life" target="_blank" class="nav-list-link">摄影集</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">订阅</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">计算不透明度对应的十六进制数值</h1><div class="post-info">Jan 15, 2021</div><div class="post-content"><p>最近在写钉钉小程序，过程中遇到了不少的坑，不过坑后面再总结，今天要讲的是关于十六进制透明度计算。</p>
<p>在这次的设计稿上我发现了这样的 <code>tag</code> 样式：</p>
<p><img src="https://personal-1251959693.cos.ap-chengdu.myqcloud.com/2021-01-15-140059.png" alt></p>
<p><img src="https://personal-1251959693.cos.ap-chengdu.myqcloud.com/2021-01-15-140134.png" alt></p>
<p>其实一眼就能看出来实现的思路，背景色其实就是跟着文字的颜色做个淡化。</p>
<p>封装组件的话，主要思路就是：写个 <code>&lt;view&gt;</code>，然后留个 <code>&lt;slot&gt;</code> 插槽用于传入文本，然后写一些样式，最后有个 <code>prop</code> 用于接受一个颜色值，给文字直接设置传入的颜色，然后给 <code>tag</code> 背景色设一个传入颜色一定透明度的色值。我的设计稿中，这个不透明度为 10%。</p>
<p>主要问题是：<strong>这个一定透明度的色值怎么计算？</strong></p>
<p>首先，前端的颜色格式有两种，一种是 RGB 格式：rgb(255, 255, 255)；另一种是十六进制：#ffffff。</p>
<p>如果给这两种颜色加上透明度，那么 RGB 格式的会变成 rgba(255, 255, 255, 1)，这个 a 就是 alpha 通道，用于设置颜色的透明度，1表示完全不透明，0表示完全透明；</p>
<p>十六进制的颜色就会变成：#ffffffff，最后会多出两位，ff表示完全不透明，00表示完全透明。</p>
<p>从上面可以看出多了一个透明度后两种色值的变化：</p>
<ol>
<li>RGB 格式的颜色从 <code>rgb</code> 变成了 <code>rgba</code>，然后括号里多了一个透明度参数。</li>
<li>十六进制则是在最后多了两位。</li>
</ol>
<p>知道区别后，对颜色处理就方便了：</p>
<p>RGB 格式的颜色可以直接用字符串替换或者指定位置插入字符串的方式将 <code>rgb</code> 转为 <code>rgba</code>。</p>
<p>十六进制的转换相对来说没有那么直观，但是也并不复杂：</p>
<p>首先我们要指定颜色的<strong>不透明度</strong>，注意是不透明度，不是透明度，css 中有一个 <code>opacity</code> 属性，就是不透明度的意思，如果你初始为透明度，那么需要先转换成不透明度，这个很简单，如果是0 - 1之间的数值，那么<code>1 - 透明度 = 不透明度</code>，如果是 0 - 100之间的数，那么就是 <code>100 - 透明度 = 不透明度</code>。</p>
<p>十六进制的透明度范围并不是 0 - 1 或 0 - 100，而是 00 - ff，用十六进制表示就是 0 - 255，到这里其实就有思路了，将不透明度 * 十进制下的十六进制完全不透明的值，再将结果转成十六进制，拼接到色值最后不就行了吗？</p>
<p>于是就有了下面的函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此方法只对十六进制色值有效</span></span><br><span class="line"><span class="comment">// color 为十六进制色值</span></span><br><span class="line"><span class="comment">// opacity 需传入0-1之间的数值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">computeColor</span>(<span class="params">color, opacity</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// 0 和 1 可以单独进行处理</span></span><br><span class="line">	<span class="comment">// 当然想要函数更健壮还可以对传入的参数进行校验，我这里就不写了</span></span><br><span class="line">	<span class="keyword">if</span>(+opacity === <span class="number">0</span>) <span class="keyword">return</span> color + <span class="string">'00'</span></span><br><span class="line">	<span class="keyword">if</span>(+opacity === <span class="number">1</span>) <span class="keyword">return</span> color + <span class="string">'ff'</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 转十六进制时必须为数字，所以用 + 转成数字类型</span></span><br><span class="line">	<span class="keyword">const</span> num = +<span class="built_in">Math</span>.floor(<span class="number">255</span> * opacity);</span><br><span class="line">	<span class="comment">// 将十进制转为十六进制</span></span><br><span class="line">	<span class="keyword">const</span> ff = num.toString(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 拼接不透明度至末尾</span></span><br><span class="line">	<span class="keyword">return</span> color + ff;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外这里也放上 RGB 与十六进制颜色互转的方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rgb 转 十六进制颜色</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">colorHex</span>(<span class="params">color</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> that = color;</span><br><span class="line">  <span class="comment">//十六进制颜色值的正则表达式</span></span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/^#([0-9a-fA-f]&#123;3&#125;|[0-9a-fA-f]&#123;6&#125;)$/</span>;</span><br><span class="line">  <span class="comment">// 如果是rgb颜色表示</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/^(rgb|RGB)/</span>.test(that)) &#123;</span><br><span class="line">    <span class="keyword">const</span> aColor = that.replace(<span class="regexp">/(?:\(|\)|rgb|RGB)*/g</span>, <span class="string">""</span>).split(<span class="string">","</span>);</span><br><span class="line">    <span class="keyword">let</span> strHex = <span class="string">"#"</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; aColor.length; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> hex = <span class="built_in">Number</span>(aColor[i]).toString(<span class="number">16</span>);</span><br><span class="line">      <span class="keyword">if</span> (hex.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        hex = <span class="string">"0"</span> + hex;</span><br><span class="line">      &#125;</span><br><span class="line">      strHex += hex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (strHex.length !== <span class="number">7</span>) &#123;</span><br><span class="line">      strHex = that;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> strHex;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (reg.test(that)) &#123;</span><br><span class="line">    <span class="keyword">const</span> aNum = that.replace(<span class="regexp">/#/</span>, <span class="string">""</span>).split(<span class="string">""</span>);</span><br><span class="line">    <span class="keyword">if</span> (aNum.length === <span class="number">6</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> that;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (aNum.length === <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> numHex = <span class="string">"#"</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; aNum.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">        numHex += aNum[i] + aNum[i];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> numHex;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> that;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 十六进制颜色转 RGB</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">colorRgb</span>(<span class="params">color</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sColor = color.toLowerCase();</span><br><span class="line">  <span class="comment">//十六进制颜色值的正则表达式</span></span><br><span class="line">  <span class="keyword">const</span> reg = <span class="regexp">/^#([0-9a-fA-f]&#123;3&#125;|[0-9a-fA-f]&#123;6&#125;)$/</span>;</span><br><span class="line">  <span class="comment">// 如果是16进制颜色</span></span><br><span class="line">  <span class="keyword">if</span> (sColor &amp;&amp; reg.test(sColor)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (sColor.length === <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> sColorNew = <span class="string">"#"</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">4</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">        sColorNew += sColor.slice(i, i + <span class="number">1</span>).concat(sColor.slice(i, i + <span class="number">1</span>));</span><br><span class="line">      &#125;</span><br><span class="line">      sColor = sColorNew;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//处理六位的颜色值</span></span><br><span class="line">    <span class="keyword">const</span> sColorChange = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">7</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">      sColorChange.push(<span class="built_in">parseInt</span>(<span class="string">"0x"</span> + sColor.slice(i, i + <span class="number">2</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"RGB("</span> + sColorChange.join(<span class="string">","</span>) + <span class="string">")"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2021/01/16/151-el-table-header/" class="prev">上一篇</a><a href="/2021/01/13/149-js-dispatchEvent/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2021 <a href="https://github.com/Tit1e" target="_blank">Tit1e</a>, powered by <a href="https://github.com/Tit1e/hexo-theme-simple" target="_blank">hexo-theme-simple</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?6349d3bc54baea0b04a65145c5e3b799";
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();

</script></body></html>