<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Vue3.0 新特性学习（二） · Tit1e</title><meta name="description" content="Vue3.0 新特性学习（二） - Tit1e"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/Tit1e/atom.xml" title="Tit1e"></head><body><div class="wrap"><header><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">过往</a></li><li class="nav-list-item"><a href="https://album.animalcrossing.life" target="_blank" class="nav-list-link">摄影集</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">订阅</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Vue3.0 新特性学习（二）</h1><div class="post-info">Jan 29, 2021</div><div class="post-content"><p><a href="https://evolly.one/2021/01/28/154-learn-vue3-1/" target="_blank" rel="noopener">Vue3.0 新特性学习（一）</a></p>
<p><code>setup</code> 内部也可以调用生命周期钩子，但是 Vue3 并没有提供 <code>beforeCreate</code> 和 <code>created</code> 对应的钩子，由上篇文章可知，<code>setup</code> 是早于这两个钩子执行的，因此 <code>setup</code> 本身就可以胜任这两个钩子的工作，并且官方也是这么说的：</p>
<blockquote>
<p>因为 <code>setup</code> 是围绕 <code>beforeCreate</code> 和 <code>created</code> 生命周期钩子运行的，所以不需要显式地定义它们。换句话说，在这些钩子中编写的任何代码都应该直接在 <code>setup</code> 函数中编写。</p>
</blockquote>
<p>其他的钩子名称有所改变，<code>beforeMount</code> 变成了 <code>onBeforeMount</code>，其他钩子的命名规则都与这个相同。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Vue.createApp(&#123;</span><br><span class="line">  setup(props) &#123;</span><br><span class="line">    Vue.onBeforeMount(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    Vue.onMounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeMount() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">4</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">app.mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://personal-1251959693.cos.ap-chengdu.myqcloud.com/2021-01-29-053700.png" alt></p>
<p>同样的钩子，<code>setup</code> 内部的钩子调用早于外部的钩子。</p>
<h4 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = Vue.createApp(&#123;</span><br><span class="line">  setup(props) &#123;</span><br><span class="line">    <span class="keyword">const</span> a = Vue.ref(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">const</span> b = Vue.computed(<span class="function"><span class="params">()</span> =&gt;</span> a.value * <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">const</span> c = Vue.computed(&#123;</span><br><span class="line">      <span class="keyword">get</span>: () =&gt; a.value * 3,</span><br><span class="line">      <span class="keyword">set</span>:val =&gt; a.value = val + 3</span><br><span class="line">    &#125;)</span><br><span class="line">    console.log(a.value) // 1</span><br><span class="line">    console.log(+ b.value) // 2</span><br><span class="line">    console.log(c.value) // 3</span><br><span class="line">    c.value = 2</span><br><span class="line">    console.log(c.value) // 15</span><br><span class="line">    console.log(a.value) // 5</span><br><span class="line">    console.log(b.value) // 10</span><br><span class="line">    console.log(c.value) // 15</span><br><span class="line">    return &#123;</span><br><span class="line">      a,</span><br><span class="line">      b,</span><br><span class="line">      c</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">app.mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<p>computed 用法与之前没什么差别。</p>
<h4 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = Vue.createApp(&#123;</span><br><span class="line">  setup(props) &#123;</span><br><span class="line">    <span class="comment">// 侦听 ref</span></span><br><span class="line">    <span class="keyword">const</span> a = Vue.ref(<span class="number">1</span>)</span><br><span class="line">    Vue.watch(a, (val, prevVal) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`a 被改变了：新值为<span class="subst">$&#123;val&#125;</span>，旧值为<span class="subst">$&#123;prevVal&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    a.value = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 侦听 getter</span></span><br><span class="line">    <span class="keyword">const</span> b = Vue.reactive(&#123;</span><br><span class="line">      x: <span class="number">1</span>,</span><br><span class="line">      y: <span class="number">2</span></span><br><span class="line">    &#125;)</span><br><span class="line">    Vue.watch(<span class="function"><span class="params">()</span> =&gt;</span> b.x, (val, prevVal) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`b.x 被改变了：新值为<span class="subst">$&#123;val&#125;</span>，旧值为<span class="subst">$&#123;prevVal&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    b.x = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听多个源</span></span><br><span class="line">    <span class="keyword">const</span> &#123; c, d &#125; = Vue.toRefs(Vue.reactive(&#123; <span class="attr">c</span>: <span class="number">3</span>, <span class="attr">d</span>: <span class="number">4</span> &#125;))</span><br><span class="line">    Vue.watch([c, d], (newValArr, preValArr) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(newValArr, preValArr)</span><br><span class="line">    &#125;)</span><br><span class="line">    c.value = <span class="number">7</span></span><br><span class="line">    d.value = <span class="number">7</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      a,</span><br><span class="line">      b</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">app.mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://personal-1251959693.cos.ap-chengdu.myqcloud.com/2021-01-29-060414.png" alt></p>
<h4 id="watchEffect"><a href="#watchEffect" class="headerlink" title="watchEffect"></a>watchEffect</h4><p><code>watchEffect</code> 接受一个回调函数，在这个回调函数中用到的<strong>任意一个响应式数据</strong>更新时，这个回调函数都会被执行，也就是说它可以监听多个响应式数据。它与 <code>watch</code> 很相似，但也有需要注意的地方：</p>
<ul>
<li><code>watchEffect</code> 无需指定要监听的属性，它自动会收集依赖，而 <code>watch</code> 必须指定。</li>
<li><code>watchEffect</code> 因为需要收集依赖。所以它在组件初始化的时候就会运行一遍，而 <code>watch</code> 默认不会运行，除非手动配置 <code>immediate: true</code>。</li>
<li><code>watchEffect</code> 无法知道是哪个值被更新，因此获取不到变化的新值与旧值。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = Vue.createApp(&#123;</span><br><span class="line">  setup(props, context) &#123;</span><br><span class="line">    <span class="comment">// 响应式</span></span><br><span class="line">    <span class="keyword">const</span> a = Vue.ref(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// 非响应式</span></span><br><span class="line">    <span class="keyword">let</span> b = <span class="number">1</span></span><br><span class="line">    Vue.watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`有值更新了！a：<span class="subst">$&#123;a.value&#125;</span>；b：<span class="subst">$&#123;b&#125;</span>。`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 不触发 watchEffect</span></span><br><span class="line">      b = <span class="number">5</span></span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 触发 watchEffect</span></span><br><span class="line">      a.value ++</span><br><span class="line">    &#125;, <span class="number">2000</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      listLoading,</span><br><span class="line">      toggleLoading</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">app.mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://personal-1251959693.cos.ap-chengdu.myqcloud.com/2021-01-29-070553.png" alt></p>
<p><code>watch</code> 与 <code>watchEffect</code> 都返回了一个 unwatch 方法用于取消侦听</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = Vue.createApp(&#123;</span><br><span class="line">  setup(props, context) &#123;</span><br><span class="line">    <span class="keyword">const</span> unWatch = Vue.watch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;)</span><br><span class="line">    <span class="comment">// 取消侦听</span></span><br><span class="line">    unWatch()</span><br><span class="line">    <span class="keyword">const</span> unWatchEffect = Vue.watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;)</span><br><span class="line">    <span class="comment">// 取消侦听</span></span><br><span class="line">    unWatchEffect()</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">app.mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="组合式函数"><a href="#组合式函数" class="headerlink" title="组合式函数"></a>组合式函数</h4><p>以前我们需要在组件之间共享代码时，一般使用 <code>mixins</code> 或作用域插槽。但它们都有一些硬伤：</p>
<ul>
<li><code>mixins</code> 多了之后变量会十分混乱，在引用文件中根本无法区分哪个变量或方法来自哪个 <code>mixins</code>。</li>
<li>作用域插槽没有变量混乱的问题，因为它的数据<strong>只能在模板中访问</strong>，但这恰好也是它的缺点。</li>
</ul>
<p>在 Vue3 中，我们配合<strong>组合式 API</strong>可以编写<strong>组合式函数</strong>，可以清楚地知道该变量来自哪个组合式函数。</p>
<p>下面是两个简单的例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span> <span class="attr">v-cloak</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123;listLoading&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"toggleLoading"</span>&gt;</span>改变状态<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123;count&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"addCount"</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// listLoading 状态的切换</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useToggleLoading</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> listLoading = Vue.ref(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">const</span> toggleLoading = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    listLoading.value = !listLoading.value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    listLoading,</span><br><span class="line">    toggleLoading</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// count 计数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useAddCount</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> count = Vue.ref(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> addCount = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    count.value++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    count,</span><br><span class="line">    addCount</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = Vue.createApp(&#123;</span><br><span class="line">  setup(props, context) &#123;</span><br><span class="line">    <span class="comment">// 来自 useToggleLoading</span></span><br><span class="line">    <span class="keyword">const</span> &#123; listLoading, toggleLoading &#125; = useToggleLoading()</span><br><span class="line">    <span class="comment">//来自 useAddCount</span></span><br><span class="line">    <span class="keyword">const</span> &#123; count, addCount &#125; = useAddCount()</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      listLoading,</span><br><span class="line">      toggleLoading,</span><br><span class="line">      count,</span><br><span class="line">      addCount</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">app.mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://personal-1251959693.cos.ap-chengdu.myqcloud.com/2021-01-29-155-learn-vue3-22.gif" alt></p>
<p>Vue2 与 Vue3 的主要区别就写到这里，还有其他很多我觉得用得相对较少的 API 文章中就不多介绍。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2021/01/28/154-learn-vue3-1/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2021 <a href="https://github.com/Tit1e" target="_blank">Tit1e</a>, powered by <a href="https://github.com/Tit1e/hexo-theme-simple" target="_blank">hexo-theme-simple</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>